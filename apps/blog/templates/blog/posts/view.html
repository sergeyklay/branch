{% extends 'post.html' %}

{% load i18n static date_to_xmlschema %}

{% block post_schema %}
    <script type="application/ld+json">
        {# TODO: Do not hardcode about_url #}
        {% include 'blog/partials/page-schema.json' with page=post featured_image=post.featured_image about_url='/pages/about.html' %}
    </script>
{% endblock %}

{% block page_meta %}
    {% if post.no_index %}
        <meta name="robots" content="noindex, nofollow">
    {% endif %}
    {# TODO: Add to Post propery #}
    <meta name="rating" content="General">
{% endblock %}

{% block canonical_url %}
    {% with resource_url=post.get_absolute_url %}
        {{ block.super }}
    {% endwith %}
{% endblock %}

{% block dc_metadata %}
    {% with resource_url=post.get_absolute_url %}
        {{ block.super }}
    {% endwith %}
    <meta property="dc:date" content="{{ post.published_at|date_to_xmlschema }}">
{% endblock %}

{% block og_metadata %}
    {% with resource_url=post.get_absolute_url featured_image=post.featured_image %}
        {{ block.super }}
    {% endwith %}
{% endblock %}

{% block twitter_metadata %}
    {% with featured_image=post.featured_image %}
        {{ block.super }}
    {% endwith %}
{% endblock %}

{% block sidebar %}
    {# TODO: Use sidebar-toc #}
    {% include 'partials/sidebar.html' %}
{% endblock %}

{% block post_content %}
    <header>
        <h1 class="text-title">{{ post.title }}</h1>
    </header>

    <p class="byline">
        <time datetime="{{ post.published_at|date_to_xmlschema }}">
            {{ post.published_at|date:"Y.m.d" }}
        </time>
    </p>

    <div class="post-body">
        {{ post.body|safe }}
    </div>

    <hr>

    <section class="comment-form-wrapper" role="dialog">
        <h2>{% trans 'Comments' %}</h2>
        <div class="comment-form">
            <form method="post" id="comment-form">
                {% csrf_token %}

                {% for hidden_field in form.hidden_fields %}
                    {{ hidden_field }}
                    {{ hidden_field.errors }}
                {% endfor %}

                <div class="comment-form-item">
                    <label class="{{ form.label_class }}" for="{{ form.user_name.id_for_label }}">
                        {% trans 'Your Name' %}&nbsp;<strong>*</strong>
                    </label>
                    {{ form.user_name }}
                    {{ form.user_name.errors|safe }}
                </div>

                <div class="comment-form-item">
                    <label class="{{ form.label_class }}" for="{{ form.user_email.id_for_label }}">
                        {% trans 'Email Address' %}&nbsp;<strong>*</strong>
                    </label>
                    {{ form.user_email }}
                    {{ form.user_email.errors|safe }}
                </div>

                <div class="comment-form-item">
                    <label class="{{ form.label_class }}" for="{{ form.comment.id_for_label }}">
                        {% trans 'Comment' %}&nbsp;<strong>*</strong>
                    </label>
                    {{ form.comment }}
                    {{ form.comment.errors|safe }}
                </div>

                <div class="comment-form-item">
                    <input type="submit" value="{% trans 'Submit' %}" class="button button-large">
                </div>
            </form>
        </div>
    </section>

    <hr>

    <section class="comment-thread">
        {% for comment in comments %}
            {% include 'blog/partials/comment.html' with comment=comment %}
        {% empty %}
            <article class="comment" id="comment-0">
                <div class="comment-heading" style="float: none">
                    <div class="comment-body">
                        {% trans 'There are no posts yet.' %}
                    </div>
                </div>
            </article>
        {% endfor %}
    </section>
{% endblock %}
